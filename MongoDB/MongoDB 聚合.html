<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 7.2.1 (456793)"/><meta name="keywords" content="MongoDB"/><meta name="created" content="2018-09-10 11:18:40 +0000"/><meta name="source" content="web.clip7"/><meta name="source-application" content="WebClipper 7"/><meta name="source-url" content="http://www.runoob.com/mongodb/mongodb-aggregate.html"/><meta name="updated" content="2018-09-10 11:18:40 +0000"/><title>MongoDB 聚合</title></head><body>
  <div>
<div style="font-size: 16px; display: inline-block;  min-width: 100%;position: relative;"><div style="font-size:62.5%;"><div style="font-size:1.2em;font-family:&quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, Arial, sans-serif;-webkit-font-smoothing:antialiased;background:url(./assets/img/bg.gif) no-repeat rgb(246, 246, 246);color:rgb(51, 51, 51);"><div><div style="min-width:755px;overflow:hidden;"><div><div style="background:rgb(255, 255, 255);border-image:initial;"><div><div>
			
			<h1 style="border:0px;padding:0px;margin:0px 0px 10px;font-size:2.1em;color:rgb(0, 0, 0);text-decoration:none;text-indent:initial;">MongoDB 聚合</h1>
<p style="border:0px;margin:0px;padding:0px;line-height:2em;word-wrap:break-word;word-break:break-all;font-size:13px;font-family:&quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, Arial, sans-serif;">MongoDB中聚合(aggregate)主要用于处理数据(诸如统计平均值,求和等)，并返回计算后的数据结果。有点类似sql语句中的 count(*)。

</p><hr style="background-color:rgb(212, 212, 212);color:rgb(212, 212, 212);height:1px;border:0px;clear:both;"/>
<h2 style="border:0px;padding:0px;margin:2px 0px;font-size:1.8em;line-height:1.8em;">aggregate() 方法</h2>
<p style="border:0px;margin:0px;padding:0px;line-height:2em;word-wrap:break-word;word-break:break-all;font-size:13px;font-family:&quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, Arial, sans-serif;">MongoDB中聚合的方法使用aggregate()。</p>
<h3 style="border:0px;padding:0px;margin:8px 0px;font-size:1.4em;font-weight:700;">语法</h3>
<p style="border:0px;margin:0px;padding:0px;line-height:2em;word-wrap:break-word;word-break:break-all;font-size:13px;font-family:&quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, Arial, sans-serif;">aggregate() 方法的基本语法格式如下所示：</p>
<pre style="word-wrap:break-word;border:0px;border-image:initial;font:12px/20px Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace;white-space:pre-wrap;word-break:break-all;margin:15px auto;border-width:1px 1px 1px 4px;border-style:solid;border-color:rgb(221, 221, 221);background:url(/images/codecolorer_bg.gif) center top rgb(251, 251, 251);padding:10px 15px;"><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">&gt;</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);">db</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">.</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);">COLLECTION_NAME</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">.</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);">aggregate</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">(</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);">AGGREGATE_OPERATION</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">)</span></pre>
<h3 style="border:0px;padding:0px;margin:8px 0px;font-size:1.4em;font-weight:700;">实例</h3>
<p style="border:0px;margin:0px;padding:0px;line-height:2em;word-wrap:break-word;word-break:break-all;font-size:13px;font-family:&quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, Arial, sans-serif;">集合中的数据如下：</p>
<pre style="word-wrap:break-word;border:0px;border-image:initial;font:12px/20px Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace;white-space:pre-wrap;word-break:break-all;margin:15px auto;border-width:1px 1px 1px 4px;border-style:solid;border-color:rgb(221, 221, 221);background:url(/images/codecolorer_bg.gif) center top rgb(251, 251, 251);padding:10px 15px;"><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">{</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);">
   _id</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 0, 102);">ObjectId</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">(</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 102, 102);">7df78ad8902c</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">)</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);">
   title</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 136, 0);">'MongoDB Overview'</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">,</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"> 
   description</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 136, 0);">'MongoDB is no sql database'</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">,</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);">
   by_user</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 136, 0);">'runoob.com'</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">,</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);">
   url</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 136, 0);">'http://www.runoob.com'</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">,</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);">
   tags</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">[</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 136, 0);">'mongodb'</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">,</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 136, 0);">'database'</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">,</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 136, 0);">'NoSQL'</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">],</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);">
   likes</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 102, 102);">100</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"
/><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">},</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"
/><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">{</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);">
   _id</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 0, 102);">ObjectId</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">(</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 102, 102);">7df78ad8902d</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">)</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);">
   title</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 136, 0);">'NoSQL Overview'</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">,</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"> 
   description</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 136, 0);">'No sql database is very fast'</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">,</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);">
   by_user</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 136, 0);">'runoob.com'</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">,</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);">
   url</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 136, 0);">'http://www.runoob.com'</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">,</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);">
   tags</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">[</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 136, 0);">'mongodb'</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">,</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 136, 0);">'database'</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">,</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 136, 0);">'NoSQL'</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">],</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);">
   likes</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 102, 102);">10</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"
/><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">},</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"
/><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">{</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);">
   _id</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 0, 102);">ObjectId</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">(</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 102, 102);">7df78ad8902e</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">)</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);">
   title</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 136, 0);">'Neo4j Overview'</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">,</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"> 
   description</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 136, 0);">'Neo4j is no sql database'</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">,</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);">
   by_user</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 136, 0);">'Neo4j'</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">,</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);">
   url</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 136, 0);">'http://www.neo4j.com'</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">,</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);">
   tags</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">[</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 136, 0);">'neo4j'</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">,</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 136, 0);">'database'</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">,</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 136, 0);">'NoSQL'</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">],</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);">
   likes</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 102, 102);">750</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"
/><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">},</span></pre>
<p style="border:0px;margin:0px;padding:0px;line-height:2em;word-wrap:break-word;word-break:break-all;font-size:13px;font-family:&quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, Arial, sans-serif;">现在我们通过以上集合计算每个作者所写的文章数，使用aggregate()计算结果如下：</p>

<pre style="word-wrap:break-word;border:0px;border-image:initial;font:12px/20px Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace;white-space:pre-wrap;word-break:break-all;margin:15px auto;border-width:1px 1px 1px 4px;border-style:solid;border-color:rgb(221, 221, 221);background:url(/images/codecolorer_bg.gif) center top rgb(251, 251, 251);padding:10px 15px;"><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">&gt;</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"> db</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">.</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);">mycol</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">.</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);">aggregate</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">([{</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);">$group </span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">{</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);">_id </span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 136, 0);">"$by_user"</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">,</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"> num_tutorial </span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">{</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);">$sum </span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 102, 102);">1</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">}}}])</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"
/><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">{</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"
   /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 136, 0);">"result"</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">[</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"
      /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">{</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"
         /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 136, 0);">"_id"</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 136, 0);">"runoob.com"</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">,</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"
         /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 136, 0);">"num_tutorial"</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 102, 102);">2</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"
      /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">},</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"
      /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">{</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"
         /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 136, 0);">"_id"</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 136, 0);">"Neo4j"</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">,</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"
         /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 136, 0);">"num_tutorial"</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 102, 102);">1</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"
      /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">}</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"
   /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">],</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"
   /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 136, 0);">"ok"</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 102, 102);">1</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"
/><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">}</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"
/><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">&gt;</span></pre>
<p style="border:0px;margin:0px;padding:0px;line-height:2em;word-wrap:break-word;word-break:break-all;font-size:13px;font-family:&quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, Arial, sans-serif;">以上实例类似sql语句：</p><pre style="word-wrap:break-word;border:0px;border-image:initial;font:12px/20px Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace;white-space:pre-wrap;word-break:break-all;margin:15px auto;border-width:1px 1px 1px 4px;border-style:solid;border-color:rgb(221, 221, 221);background:url(/images/codecolorer_bg.gif) center top rgb(251, 251, 251);padding:10px 15px;"><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 136);">select</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"> by_user</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">,</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"> count</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">(*)</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 136);">from</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"> mycol </span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 136);">group</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 136);">by</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"> by_user</span></pre>
<p style="border:0px;margin:0px;padding:0px;line-height:2em;word-wrap:break-word;word-break:break-all;font-size:13px;font-family:&quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, Arial, sans-serif;">在上面的例子中，我们通过字段 by_user 字段对数据进行分组，并计算 by_user 字段相同值的总和。</p>
<p style="border:0px;margin:0px;padding:0px;line-height:2em;word-wrap:break-word;word-break:break-all;font-size:13px;font-family:&quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, Arial, sans-serif;">下表展示了一些聚合的表达式:</p>
<table style="margin:0px;font-size:inherit;font-style:inherit;font-variant:inherit;font-weight:inherit;border:0px;padding:0px;border-collapse:collapse;width:100%;margin-bottom:4px;margin-top:4px;">
<tbody style="border:0px;margin:0px;padding:0px;"><tr style="border:0px;margin:0px;padding:0px;background-color:rgb(246, 244, 240);"><th style="margin:0px;border:1px solid rgb(85, 85, 85);padding:3px;font-size:12px;color:rgb(255, 255, 255);background-color:rgb(85, 85, 85);vertical-align:top;text-align:left;width:10%;">表达式</th><th style="margin:0px;border:1px solid rgb(85, 85, 85);padding:3px;font-size:12px;color:rgb(255, 255, 255);background-color:rgb(85, 85, 85);vertical-align:top;text-align:left;width:50%;">描述</th><th style="margin:0px;border:1px solid rgb(85, 85, 85);padding:3px;font-size:12px;color:rgb(255, 255, 255);background-color:rgb(85, 85, 85);vertical-align:top;text-align:left;">实例</th></tr>
<tr style="border:0px;margin:0px;padding:0px;background-color:rgb(255, 255, 255);"><td style="margin:0px;font-size:13px;border:1px solid rgb(212, 212, 212);padding:7px 5px;min-width:24px;line-height:2em;vertical-align:top;">$sum</td><td style="margin:0px;font-size:13px;border:1px solid rgb(212, 212, 212);padding:7px 5px;line-height:2em;min-width:24px;vertical-align:top;">计算总和。</td><td style="margin:0px;font-size:13px;border:1px solid rgb(212, 212, 212);padding:7px 5px;line-height:2em;min-width:24px;vertical-align:top;">db.mycol.aggregate([{$group : {_id : "$by_user", num_tutorial : {$sum : "$likes"}}}])</td></tr>
<tr style="border:0px;margin:0px;padding:0px;background-color:rgb(246, 244, 240);"><td style="margin:0px;font-size:13px;border:1px solid rgb(212, 212, 212);padding:7px 5px;min-width:24px;line-height:2em;vertical-align:top;">$avg</td><td style="margin:0px;font-size:13px;border:1px solid rgb(212, 212, 212);padding:7px 5px;line-height:2em;min-width:24px;vertical-align:top;">计算平均值</td><td style="margin:0px;font-size:13px;border:1px solid rgb(212, 212, 212);padding:7px 5px;line-height:2em;min-width:24px;vertical-align:top;">db.mycol.aggregate([{$group : {_id : "$by_user", num_tutorial : {$avg : "$likes"}}}])</td></tr>
<tr style="border:0px;margin:0px;padding:0px;background-color:rgb(255, 255, 255);"><td style="margin:0px;font-size:13px;border:1px solid rgb(212, 212, 212);padding:7px 5px;min-width:24px;line-height:2em;vertical-align:top;">$min</td><td style="margin:0px;font-size:13px;border:1px solid rgb(212, 212, 212);padding:7px 5px;line-height:2em;min-width:24px;vertical-align:top;">获取集合中所有文档对应值得最小值。</td><td style="margin:0px;font-size:13px;border:1px solid rgb(212, 212, 212);padding:7px 5px;line-height:2em;min-width:24px;vertical-align:top;">db.mycol.aggregate([{$group : {_id : "$by_user", num_tutorial : {$min : "$likes"}}}])</td></tr>
<tr style="border:0px;margin:0px;padding:0px;background-color:rgb(246, 244, 240);"><td style="margin:0px;font-size:13px;border:1px solid rgb(212, 212, 212);padding:7px 5px;min-width:24px;line-height:2em;vertical-align:top;">$max</td><td style="margin:0px;font-size:13px;border:1px solid rgb(212, 212, 212);padding:7px 5px;line-height:2em;min-width:24px;vertical-align:top;">获取集合中所有文档对应值得最大值。</td><td style="margin:0px;font-size:13px;border:1px solid rgb(212, 212, 212);padding:7px 5px;line-height:2em;min-width:24px;vertical-align:top;">db.mycol.aggregate([{$group : {_id : "$by_user", num_tutorial : {$max : "$likes"}}}])</td></tr>
<tr style="border:0px;margin:0px;padding:0px;background-color:rgb(255, 255, 255);"><td style="margin:0px;font-size:13px;border:1px solid rgb(212, 212, 212);padding:7px 5px;min-width:24px;line-height:2em;vertical-align:top;">$push</td><td style="margin:0px;font-size:13px;border:1px solid rgb(212, 212, 212);padding:7px 5px;line-height:2em;min-width:24px;vertical-align:top;">在结果文档中插入值到一个数组中。</td><td style="margin:0px;font-size:13px;border:1px solid rgb(212, 212, 212);padding:7px 5px;line-height:2em;min-width:24px;vertical-align:top;">db.mycol.aggregate([{$group : {_id : "$by_user", url : {$push: "$url"}}}])</td></tr>
<tr style="border:0px;margin:0px;padding:0px;background-color:rgb(246, 244, 240);"><td style="margin:0px;font-size:13px;border:1px solid rgb(212, 212, 212);padding:7px 5px;min-width:24px;line-height:2em;vertical-align:top;">$addToSet</td><td style="margin:0px;font-size:13px;border:1px solid rgb(212, 212, 212);padding:7px 5px;line-height:2em;min-width:24px;vertical-align:top;">在结果文档中插入值到一个数组中，但不创建副本。</td><td style="margin:0px;font-size:13px;border:1px solid rgb(212, 212, 212);padding:7px 5px;line-height:2em;min-width:24px;vertical-align:top;">db.mycol.aggregate([{$group : {_id : "$by_user", url : {$addToSet : "$url"}}}])</td></tr>
<tr style="border:0px;margin:0px;padding:0px;background-color:rgb(255, 255, 255);"><td style="margin:0px;font-size:13px;border:1px solid rgb(212, 212, 212);padding:7px 5px;min-width:24px;line-height:2em;vertical-align:top;">$first</td><td style="margin:0px;font-size:13px;border:1px solid rgb(212, 212, 212);padding:7px 5px;line-height:2em;min-width:24px;vertical-align:top;">根据资源文档的排序获取第一个文档数据。</td><td style="margin:0px;font-size:13px;border:1px solid rgb(212, 212, 212);padding:7px 5px;line-height:2em;min-width:24px;vertical-align:top;">db.mycol.aggregate([{$group : {_id : "$by_user", first_url : {$first : "$url"}}}])</td></tr>
<tr style="border:0px;margin:0px;padding:0px;background-color:rgb(246, 244, 240);"><td style="margin:0px;font-size:13px;border:1px solid rgb(212, 212, 212);padding:7px 5px;min-width:24px;line-height:2em;vertical-align:top;">$last</td><td style="margin:0px;font-size:13px;border:1px solid rgb(212, 212, 212);padding:7px 5px;line-height:2em;min-width:24px;vertical-align:top;">根据资源文档的排序获取最后一个文档数据</td><td style="margin:0px;font-size:13px;border:1px solid rgb(212, 212, 212);padding:7px 5px;line-height:2em;min-width:24px;vertical-align:top;">db.mycol.aggregate([{$group : {_id : "$by_user", last_url : {$last : "$url"}}}])</td></tr>
</tbody></table>
<hr style="background-color:rgb(212, 212, 212);color:rgb(212, 212, 212);height:1px;border:0px;clear:both;"/>
<h2 style="border:0px;padding:0px;margin:2px 0px;font-size:1.8em;line-height:1.8em;">管道的概念</h2>
<p style="border:0px;margin:0px;padding:0px;line-height:2em;word-wrap:break-word;word-break:break-all;font-size:13px;font-family:&quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, Arial, sans-serif;">管道在Unix和Linux中一般用于将当前命令的输出结果作为下一个命令的参数。
</p><p style="border:0px;margin:0px;padding:0px;line-height:2em;word-wrap:break-word;word-break:break-all;font-size:13px;font-family:&quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, Arial, sans-serif;">MongoDB的聚合管道将MongoDB文档在一个管道处理完毕后将结果传递给下一个管道处理。管道操作是可以重复的。</p><p style="border:0px;margin:0px;padding:0px;line-height:2em;word-wrap:break-word;word-break:break-all;font-size:13px;font-family:&quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, Arial, sans-serif;">
表达式：处理输入文档并输出。表达式是无状态的，只能用于计算当前聚合管道的文档，不能处理其它的文档。</p>
<p style="border:0px;margin:0px;padding:0px;line-height:2em;word-wrap:break-word;word-break:break-all;font-size:13px;font-family:&quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, Arial, sans-serif;">这里我们介绍一下聚合框架中常用的几个操作：</p>
<ul style="border:0px;list-style:none;margin:0px;padding:0px;line-height:140%;list-style-type:none;margin-top:1em;margin-bottom:1em;"><li style="background-size:auto 8px;list-style-type:none;background-repeat:no-repeat;background-position:left 0.5em;padding:0px 0px 0px 1.5em;background-image:url(./assets/img/bullet.png);border:0px;margin:0px 0px 1em 1em;line-height:1.5em;font-size:13px;word-break:break-all;">
$project：修改输入文档的结构。可以用来重命名、增加或删除域，也可以用于创建计算结果以及嵌套文档。</li><li style="background-size:auto 8px;list-style-type:none;background-repeat:no-repeat;background-position:left 0.5em;padding:0px 0px 0px 1.5em;background-image:url(./assets/img/bullet.png);border:0px;margin:0px 0px 1em 1em;line-height:1.5em;font-size:13px;word-break:break-all;">
$match：用于过滤数据，只输出符合条件的文档。$match使用MongoDB的标准查询操作。</li><li style="background-size:auto 8px;list-style-type:none;background-repeat:no-repeat;background-position:left 0.5em;padding:0px 0px 0px 1.5em;background-image:url(./assets/img/bullet.png);border:0px;margin:0px 0px 1em 1em;line-height:1.5em;font-size:13px;word-break:break-all;">
$limit：用来限制MongoDB聚合管道返回的文档数。</li><li style="background-size:auto 8px;list-style-type:none;background-repeat:no-repeat;background-position:left 0.5em;padding:0px 0px 0px 1.5em;background-image:url(./assets/img/bullet.png);border:0px;margin:0px 0px 1em 1em;line-height:1.5em;font-size:13px;word-break:break-all;">
$skip：在聚合管道中跳过指定数量的文档，并返回余下的文档。</li><li style="background-size:auto 8px;list-style-type:none;background-repeat:no-repeat;background-position:left 0.5em;padding:0px 0px 0px 1.5em;background-image:url(./assets/img/bullet.png);border:0px;margin:0px 0px 1em 1em;line-height:1.5em;font-size:13px;word-break:break-all;">
$unwind：将文档中的某一个数组类型字段拆分成多条，每条包含数组中的一个值。</li><li style="background-size:auto 8px;list-style-type:none;background-repeat:no-repeat;background-position:left 0.5em;padding:0px 0px 0px 1.5em;background-image:url(./assets/img/bullet.png);border:0px;margin:0px 0px 1em 1em;line-height:1.5em;font-size:13px;word-break:break-all;">
$group：将集合中的文档分组，可用于统计结果。</li><li style="background-size:auto 8px;list-style-type:none;background-repeat:no-repeat;background-position:left 0.5em;padding:0px 0px 0px 1.5em;background-image:url(./assets/img/bullet.png);border:0px;margin:0px 0px 1em 1em;line-height:1.5em;font-size:13px;word-break:break-all;">
$sort：将输入文档排序后输出。</li><li style="background-size:auto 8px;list-style-type:none;background-repeat:no-repeat;background-position:left 0.5em;padding:0px 0px 0px 1.5em;background-image:url(./assets/img/bullet.png);border:0px;margin:0px 0px 1em 1em;line-height:1.5em;font-size:13px;word-break:break-all;">
$geoNear：输出接近某一地理位置的有序文档。</li></ul>
<h3 style="border:0px;padding:0px;margin:8px 0px;font-size:1.4em;font-weight:700;">管道操作符实例</h3>
<p style="border:0px;margin:0px;padding:0px;line-height:2em;word-wrap:break-word;word-break:break-all;font-size:13px;font-family:&quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, Arial, sans-serif;">1、$project实例</p><p style="border:0px;margin:0px;padding:0px;line-height:2em;word-wrap:break-word;word-break:break-all;font-size:13px;font-family:&quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, Arial, sans-serif;"
/><pre style="word-wrap:break-word;border:0px;border-image:initial;font:12px/20px Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace;white-space:pre-wrap;word-break:break-all;margin:15px auto;border-width:1px 1px 1px 4px;border-style:solid;border-color:rgb(221, 221, 221);background:url(/images/codecolorer_bg.gif) center top rgb(251, 251, 251);padding:10px 15px;"><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);">db</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">.</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);">article</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">.</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);">aggregate</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">(</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"
    /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">{</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"> $project </span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">{</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);">
        title </span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 102, 102);">1</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">,</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);">
        author </span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 102, 102);">1</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">,</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"
    /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">}}</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"
 /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">);</span></pre>
<p style="border:0px;margin:0px;padding:0px;line-height:2em;word-wrap:break-word;word-break:break-all;font-size:13px;font-family:&quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, Arial, sans-serif;">这样的话结果中就只还有_id,tilte和author三个字段了，默认情况下_id字段是被包含的，如果要想不包含_id话可以这样:</p>
<pre style="word-wrap:break-word;border:0px;border-image:initial;font:12px/20px Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace;white-space:pre-wrap;word-break:break-all;margin:15px auto;border-width:1px 1px 1px 4px;border-style:solid;border-color:rgb(221, 221, 221);background:url(/images/codecolorer_bg.gif) center top rgb(251, 251, 251);padding:10px 15px;"><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);">db</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">.</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);">article</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">.</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);">aggregate</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">(</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"
    /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">{</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"> $project </span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">{</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);">
        _id </span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 102, 102);">0</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">,</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);">
        title </span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 102, 102);">1</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">,</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);">
        author </span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 102, 102);">1</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"
    /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">}});</span></pre>
<p style="border:0px;margin:0px;padding:0px;line-height:2em;word-wrap:break-word;word-break:break-all;font-size:13px;font-family:&quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, Arial, sans-serif;">2.$match实例</p>
<pre style="word-wrap:break-word;border:0px;border-image:initial;font:12px/20px Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace;white-space:pre-wrap;word-break:break-all;margin:15px auto;border-width:1px 1px 1px 4px;border-style:solid;border-color:rgb(221, 221, 221);background:url(/images/codecolorer_bg.gif) center top rgb(251, 251, 251);padding:10px 15px;"><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);">db</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">.</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);">articles</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">.</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);">aggregate</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">(</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">[</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"
                        /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">{</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"> $match </span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">{</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"> score </span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">{</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"> $gt </span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 102, 102);">70</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">,</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"> $lte </span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 102, 102);">90</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">}</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">}</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">},</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"
                        /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">{</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"> $group</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">{</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"> _id</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 136);">null</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">,</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"> count</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">{</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"> $sum</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 102, 102);">1</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">}</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">}</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">}</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"
                       /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">]</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">);</span></pre>
<p style="border:0px;margin:0px;padding:0px;line-height:2em;word-wrap:break-word;word-break:break-all;font-size:13px;font-family:&quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, Arial, sans-serif;">  $match用于获取分数大于70小于或等于90记录，然后将符合条件的记录送到下一阶段$group管道操作符进行处理。</p>
<p style="border:0px;margin:0px;padding:0px;line-height:2em;word-wrap:break-word;word-break:break-all;font-size:13px;font-family:&quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, Arial, sans-serif;">3.$skip实例</p>
<pre style="word-wrap:break-word;border:0px;border-image:initial;font:12px/20px Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace;white-space:pre-wrap;word-break:break-all;margin:15px auto;border-width:1px 1px 1px 4px;border-style:solid;border-color:rgb(221, 221, 221);background:url(/images/codecolorer_bg.gif) center top rgb(251, 251, 251);padding:10px 15px;"><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);">db</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">.</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);">article</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">.</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);">aggregate</span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">(</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"
    /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">{</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"> $skip </span><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">:</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 102, 102);">5</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);" /><span style="border:0px;margin:0px;padding:0px;color:rgb(102, 102, 0);">});</span><span style="border:0px;margin:0px;padding:0px;color:rgb(0, 0, 0);"
/></pre>
<p style="border:0px;margin:0px;padding:0px;line-height:2em;word-wrap:break-word;word-break:break-all;font-size:13px;font-family:&quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, Arial, sans-serif;">经过$skip管道操作符处理后，前五个文档被"过滤"掉。
</p>
 
			
			
			</div></div></div></div></div></div></div></div></div>
</div>
</body></html>